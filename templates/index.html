<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Actionable E-commerce Sentiment Dashboard — Bright Radial Dark Text</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
:root{
  --bg-rad1: radial-gradient(circle at 10% 20%, rgba(255,255,59,0.18), transparent 12%), radial-gradient(circle at 90% 80%, rgba(124,58,237,0.18), transparent 12%);
  --bg-rad2: radial-gradient(circle at 20% 10%, rgba(0,221,255,0.16), transparent 12%), radial-gradient(circle at 80% 90%, rgba(255,107,107,0.16), transparent 12%);
  --surface: rgba(255,255,255,0.02);
  --card: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  --glass: rgba(255,255,255,0.02);
  --text-dark: #03121a; /* very dark for max contrast */
  --muted: #6e7a86;
  --accent-violet: #8b5cf6; /* brighter violet */
  --accent-coral: #ff4d6d; /* punchier coral */
  --accent-teal: #00ffd1; /* neon teal */
  --accent-yellow: #ffdf5a; /* bright yellow */
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%;}
body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(180deg,#ffffff,#f7fbff), var(--bg-rad1), var(--bg-rad2);
    color: var(--text-dark);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    transition: background 0.4s ease;
    margin: 0;
}

/* Layout */
.container-fluid{padding:22px 28px;}
.main-grid{
  display:grid;
  grid-template-columns: 320px minmax(680px, 1fr);
  gap:26px;
  align-items:start;
}
@media (max-width: 1100px){ .main-grid{ grid-template-columns: 280px 1fr } }
@media (max-width: 900px){ .main-grid{ grid-template-columns: 1fr } }

/* Header */
.header {
    background: radial-gradient(circle at 10% 20%, rgba(139,92,246,0.16), transparent 8%), radial-gradient(circle at 90% 80%, rgba(0,221,255,0.10), transparent 8%), linear-gradient(90deg,#fff 0%, #f8fcff 100%);
    color: var(--text-dark);
    padding: 22px;
    margin-bottom: 18px;
    border-radius: 12px;
    text-shadow: 0 6px 20px rgba(139,92,246,0.06);
    box-shadow: 0 18px 60px rgba(3,18,26,0.06);
}
.header h1{font-weight:800; letter-spacing:-0.3px; margin:0;}
.header p{color:var(--muted); margin:4px 0 0 0;}

/* Sidebar */
.sidebar{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:18px;
    position:sticky; top:22px;
    height: calc(100vh - 44px);
    overflow:auto;
    border:1px solid rgba(3,18,26,0.04);
    box-shadow: 0 20px 60px rgba(3,18,26,0.06);
}
.sidebar h5{color:var(--accent-yellow); text-transform:uppercase; letter-spacing:1px}
.sidebar .nav{margin-top:12px}
.sidebar-link{
  display:flex; align-items:center; gap:10px; padding:10px 14px; border-radius:10px; color:var(--text-dark);
  background: linear-gradient(90deg, rgba(139,92,246,0.06), rgba(255,77,109,0.03));
  text-decoration:none; font-weight:700; transition: transform .22s ease, box-shadow .22s ease;
}
.sidebar-link.inactive{ background: transparent; color:var(--text-dark); box-shadow:none; opacity:0.92 }
.sidebar-link:hover{ transform: translateX(10px); box-shadow: 0 18px 36px rgba(3,18,26,0.06) }
.sidebar-link i{font-size:1.05rem; color:var(--accent-violet) }

/* Main content (fallback to older class) */
.main-content{ margin-left: 0; }

/* Cards */
.card{ border-radius:14px; background:var(--card); border:1px solid rgba(3,18,26,0.04); }
.card-sentiment{ transition: transform .35s cubic-bezier(.2,.9,.2,1), box-shadow .35s; transform-origin:center; }
.card-sentiment:hover{ transform: perspective(900px) rotateX(6deg) rotateY(-4deg) translateY(-10px) scale(1.02); box-shadow: 0 30px 70px rgba(3,18,26,0.10) }

/* subtle animations */
.fade-in{ animation: fadeInUp .6s ease both; }
@keyframes fadeInUp{ from{ opacity:0; transform: translateY(8px) } to{ opacity:1; transform:none } }

/* Buttons */
.btn-pill{ border-radius:999px; font-weight:700; }
.btn-primary{
  background: linear-gradient(90deg,var(--accent-violet),var(--accent-coral));
  border:none; box-shadow: 0 12px 30px rgba(139,92,246,0.12);
  transition: transform .22s ease, box-shadow .22s ease;
}
.btn-primary:hover{ transform: translateY(-6px) scale(1.02); box-shadow: 0 26px 60px rgba(139,92,246,0.14) }
.btn-outline-secondary{ border-radius:999px; }

/* File drop */
.file-drop{
  border-radius:12px; padding:18px; text-align:center; border:2px dashed rgba(3,18,26,0.06);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s;
  cursor:pointer;
}
.file-drop:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(3,18,26,0.06); border-color: rgba(139,92,246,0.16) }
.file-drop.dragover{ border-color: rgba(0,255,209,0.18); box-shadow: 0 28px 60px rgba(0,255,209,0.06) }
.file-drop i{ font-size:28px; color:var(--accent-violet) }

/* Badges (vibrant) */
.badge-positive{ background: linear-gradient(90deg,var(--accent-teal), #06d6a0); color:#04201a; font-weight:700; }
.badge-negative{ background: linear-gradient(90deg,var(--accent-coral), #ff8787); color:#fff; font-weight:700; }
.badge-neutral{ background: linear-gradient(90deg,#9aa5b1,#c9d6e3); color:#062; font-weight:700; }
.badge-anger{ background: linear-gradient(90deg,#ff7043,#ff5722); color:white; font-weight:700; }
.badge-joy{ background: linear-gradient(90deg,#ffd166,#fff4b7); color:#3b1f00; font-weight:700; }
.badge-churn{ background: linear-gradient(90deg,#ffc107,#ffd54f); color:#2b2b00; font-weight:700; }
.badge-inquiry{ background: linear-gradient(90deg,#5bc0de,#7ad8ea); color:#002b33; font-weight:700; }
.badge-sarcasm{ background: linear-gradient(90deg,#ff9800,#ffb74d); color:#2b1a00; font-weight:700; }

/* Aspect tag */
.aspect-tag{ margin-right:8px; margin-top:6px; font-weight:700; padding:6px 10px; border-radius:999px; display:inline-block; }

/* Ratings */
.rating-star{ color: gold; margin-right:3px; }

/* List item hover */
.list-group-item{ border-radius:10px; border:none; transition: transform .18s ease, box-shadow .18s ease; background: rgba(255,255,255,0.005); }
.list-group-item:hover{ transform: translateY(-10px); box-shadow: 0 22px 46px rgba(3,18,26,0.06) }

/* Dashboard grid */
.dashboard-grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:18px; margin-bottom:18px; }
@media(max-width:1200px){ .dashboard-grid{ grid-template-columns: repeat(2,1fr) } }
@media(max-width:768px){ .dashboard-grid{ grid-template-columns: 1fr } }

/* Neon glow for header and numbers */
.header h1{ text-shadow: 0 8px 40px rgba(139,92,246,0.12); }
#positiveCount{ text-shadow: 0 10px 40px rgba(0,255,209,0.06); }
#negativeCount{ text-shadow: 0 10px 40px rgba(255,77,109,0.06); }
#neutralCount{ text-shadow: 0 8px 30px rgba(147,156,167,0.04); }

/* Responsive small tweaks */
@media (max-width: 992px){
  .sidebar{ position: relative; width:100%; height:auto; margin-bottom:12px; top:0; left:0; }
  .container-fluid{ padding:14px; }
}
</style>
</head>
<body>

<div class="container-fluid">
  <div class="main-grid">
    <aside class="sidebar">
      <h5 class="text-center mb-4">Sentiment Tool</h5>
      <nav class="nav flex-column mb-3">
        <a class="sidebar-link" href="#" onclick="showSection('manual-analysis-section', this); return false;">
          <i class="bi bi-pencil-square"></i> Manual Analysis
        </a>
        <a class="sidebar-link inactive mt-2" href="#" onclick="showSection('bulk-analysis-output', this); return false;">
          <i class="bi bi-speedometer2"></i> Automated Analysis
        </a>
      </nav>

      <hr style="border-color: rgba(3,18,26,0.04); margin:12px 0" />
      <div style="font-size:14px; color:var(--muted); line-height:1.35">
        <strong>Tips:</strong>
        <ul style="margin:8px 0 0 18px; padding:0; color:var(--muted)">
          <li>Upload CSV, TXT, PDF, DOCX, XLSX — demo parses CSV/TXT client-side</li>
          <li>For PDF/DOCX/XLSX, parse on server for best accuracy</li>
          <li>Use keyword search to filter local results</li>
        </ul>
      </div>
    </aside>

    <main>
      <header class="header fade-in">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1>🚀 Detailed Sentiment Analysis Dashboard</h1>
            <p id="header-subtitle">Manually Analyze Text or Upload File</p>
          </div>
          <div>
            <button class="btn btn-pill btn-primary me-2" onclick="generatePDFReport()"><i class="bi bi-download me-2"></i>Export</button>
            <button class="btn btn-outline-secondary btn-pill" onclick="location.reload()">Reset</button>
          </div>
        </div>
      </header>

      <section id="manual-analysis-section" class="mb-4">
        <div class="card p-3 mb-3">
          <ul class="nav nav-tabs card-header-tabs mb-3">
            <li class="nav-item"><a class="nav-link active" href="#single-review-tab" data-bs-toggle="tab">Single Text</a></li>
            <li class="nav-item"><a class="nav-link" href="#file-upload-tab" data-bs-toggle="tab">Upload File</a></li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane fade show active" id="single-review-tab">
              <textarea id="reviewInput" class="form-control mb-3" rows="3" placeholder="Type a review here..."></textarea>
              <div class="d-flex gap-2">
                <button class="btn btn-pill btn-primary" onclick="analyzeSingleReview()">Analyze</button>
                <button class="btn btn-outline-secondary btn-pill" onclick="document.getElementById('reviewInput').value=''">Clear</button>
              </div>

              <div id="singleReviewOutput" class="mt-4 p-3" style="display:none;">
                <h6>Detailed Analysis Result:</h6>
                <p class="mb-1">Overall Sentiment: <span id="singleSentiment" class="badge"></span></p>
                <p class="mb-1">Emotion Detected: <span id="singleEmotion" class="badge"></span></p>
                <p class="mb-1">User Intent: <span id="singleIntent" class="badge bg-primary"></span></p>
                <p class="mb-1">Aspects: <span id="singleAspects"></span></p>
                <p class="mb-0">Advanced Flags:
                  <span id="singleSarcasm" class="badge"></span>
                  <span id="singleLanguage" class="badge bg-secondary"></span>
                </p>
              </div>
            </div>

            <div class="tab-pane fade" id="file-upload-tab">
              <p class="text-muted">Upload a file (CSV, TXT, PDF, DOCX, XLSX) for bulk analysis.</p>

              <label class="file-drop mb-3" id="fileDropLabel">
                <input type="file" id="fileInput" accept=".csv,.txt,.pdf,.doc,.docx,.xls,.xlsx" />
                <div>
                  <i class="bi bi-cloud-arrow-up" style="color:var(--accent-violet)"></i>
                  <div style="margin-top:6px">Click to select or drag & drop a file</div>
                  <small>Supported: csv, txt, pdf, docx, xlsx</small>
                </div>
              </label>

              <div class="mt-3 d-flex gap-2">
                <button class="btn btn-pill btn-primary" onclick="handleFileUpload()">Upload & Analyze</button>
                <button class="btn btn-outline-secondary btn-pill" onclick="document.getElementById('fileInput').value=''; document.getElementById('filePreview').style.display='none'">Clear</button>
              </div>

              <div id="filePreview" class="mt-3" style="display:none;"></div>
            </div>
          </div>
        </div>

        <div class="card p-3">
          <h5 class="mb-3">Single Review Result</h5>
          <div id="singleReviewDetails" class="text-muted">Results will appear here after analysis.</div>
        </div>
      </section>

      <section id="bulk-analysis-output">
        <div id="resultsContainer" style="display:none">
          <div class="dashboard-grid mb-3">
            <div class="card card-sentiment p-3 text-center">
              <h6 class="mb-1">Positive</h6>
              <div id="positiveCount" style="font-size:36px; font-weight:800; color:var(--accent-teal)">0</div>
            </div>
            <div class="card card-sentiment p-3 text-center">
              <h6 class="mb-1">Negative</h6>
              <div id="negativeCount" style="font-size:36px; font-weight:800; color:var(--accent-coral)">0</div>
            </div>
            <div class="card card-sentiment p-3 text-center">
              <h6 class="mb-1">Neutral</h6>
              <div id="neutralCount" style="font-size:36px; font-weight:800; color:var(--muted)">0</div>
            </div>
          </div>

          <div class="row g-3">
            <div class="col-lg-6">
              <div class="card p-3"><h6>Sentiment Distribution</h6><canvas id="sentimentChart"></canvas></div>
            </div>
            <div class="col-lg-6">
              <div class="card p-3"><h6>Aspect Matrix</h6><canvas id="aspectMatrixChart"></canvas></div>
            </div>
            <div class="col-lg-6 mt-3">
              <div class="card p-3"><h6>Trend Over Time</h6><canvas id="timeSeriesChart"></canvas></div>
            </div>
            <div class="col-lg-6 mt-3">
              <div class="card p-3">
                <div class="d-flex mb-2">
                  <div class="me-2">
                    <button class="btn btn-outline-secondary btn-sm" onclick="filterReviews('All')">All</button>
                    <button class="btn btn-outline-success btn-sm" onclick="filterReviews('Positive')">Positive</button>
                    <button class="btn btn-outline-danger btn-sm" onclick="filterReviews('Negative')">Negative</button>
                  </div>
                  <input id="keywordSearch" class="form-control form-control-sm ms-auto" placeholder="Search..." onkeyup="filterReviews('All')" />
                </div>
                <div style="max-height:420px; overflow:auto"><ul class="list-group" id="detailedResultsList"></ul></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
// --- Global state ---
let sentimentChart, aspectMatrixChart, timeSeriesChart;
let allReviewData = [];
let currentAnalysisData = {};

// small helpers (kept consistent with previous logic)
function getSentimentClass(sentiment){
    if (!sentiment) return 'badge-neutral';
    const s = String(sentiment).toLowerCase();
    if (s.includes('positive') || s.includes('joy')) return 'badge-positive';
    if (s.includes('negative') || s.includes('anger')) return 'badge-negative';
    return 'badge-neutral';
}
function getStarRating(rating){ if (!rating) return ''; const star = '<i class="bi bi-star-fill rating-star"></i>'; return star.repeat(Math.max(0, Math.min(5, parseInt(rating)||0))); }
function formatAspects(aspects){ let html=''; if(!aspects) return html; for(const k in aspects){ html += `<span class="aspect-tag ${getSentimentClass(aspects[k])}">${k}</span>`; } return html; }

// UI: show/hide sections
function showSection(sectionId, element){
    ['manual-analysis-section','bulk-analysis-output'].forEach(id=>{ const el=document.getElementById(id); if(el) el.style.display = (id===sectionId)?'block':'none'; });
    document.querySelectorAll('.sidebar-link').forEach(l=>l.classList.add('inactive'));
    if(element) element.classList.remove('inactive');
    document.getElementById('header-subtitle').textContent = (sectionId==='manual-analysis-section')? 'Manually Analyze Text or Upload File' : 'Automated Analysis';
    if (sectionId === 'bulk-analysis-output') document.getElementById('resultsContainer').style.display = 'block';
}

// Single review mock analyzer (keeps your rules)
function analyzeSingleReview(){
    const review = document.getElementById('reviewInput').value.trim();
    if(!review){ alert('Enter a review to analyze.'); return; }
    const txt = review.toLowerCase();
    let sentiment='Neutral', emotion='Neutral', intent='N/A', aspects={}, sarcasm=false, lang='English';
    if(txt.match(/(superb|excellent|loved|amazing|mast hai|badiya)/)) { sentiment='Positive'; emotion='Joy'; }
    else if(txt.match(/(poor|bad|broke|cancel|disappoint)/)) { sentiment='Negative'; emotion='Anger'; }
    if(txt.includes('battery')) aspects['Battery'] = txt.includes('poor')? 'Negative':'Positive';
    if(txt.includes('screen')) aspects['Screen'] = txt.includes('superb')? 'Positive':'Neutral';
    if(txt.includes('mast hai')|| txt.includes('badiya')) lang='Hinglish';
    if(txt.includes('amazing quality') && txt.includes('broke')) { sarcasm=true; sentiment='Negative'; emotion='Anger'; }

    // populate DOM
    document.getElementById('singleSentiment').textContent = sentiment; document.getElementById('singleSentiment').className = 'badge ' + getSentimentClass(sentiment);
    document.getElementById('singleEmotion').textContent = emotion; document.getElementById('singleEmotion').className = 'badge ' + getSentimentClass(emotion);
    document.getElementById('singleIntent').textContent = intent; document.getElementById('singleIntent').className = 'badge bg-primary';
    document.getElementById('singleAspects').innerHTML = formatAspects(aspects);
    document.getElementById('singleSarcasm').textContent = sarcasm? '⚠️ Sarcasm Detected' : 'No Sarcasm'; document.getElementById('singleSarcasm').className = sarcasm? 'badge badge-sarcasm':'badge bg-success';
    document.getElementById('singleLanguage').textContent = 'Lang: ' + lang;
    document.getElementById('singleReviewOutput').style.display = 'block';
    document.getElementById('reviewInput').value = '';
}

// --- File handling: accept many formats, lightweight client-side demo processing ---
// drag & drop UX
const fileDropLabel = document.getElementById('fileDropLabel');
if(fileDropLabel){
    ['dragenter','dragover'].forEach(ev=> fileDropLabel.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); fileDropLabel.classList.add('dragover'); }));
    ['dragleave','drop'].forEach(ev=> fileDropLabel.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); fileDropLabel.classList.remove('dragover'); }));
    fileDropLabel.addEventListener('drop', (e)=>{ const f = e.dataTransfer.files && e.dataTransfer.files[0]; if(f){ document.getElementById('fileInput').files = e.dataTransfer.files; showFilePreview(f); } });
}

// show a simple preview of the chosen file
function showFilePreview(file){
    const p = document.getElementById('filePreview'); p.style.display='block'; p.innerHTML = `<div class="p-3 rounded-3" style="background:rgba(255,255,255,0.01); border:1px dashed rgba(3,18,26,0.03)"><strong>Selected:</strong> ${file.name} <small class="text-muted ms-2">(${Math.round(file.size/1024)} KB)</small></div>`;
}

document.getElementById('fileInput').addEventListener('change', (e)=>{ const f = e.target.files && e.target.files[0]; if(f) showFilePreview(f); });

// process the uploaded file (demo behavior: parse CSV/TXT, accept others)
function handleFileUpload(){
    const input = document.getElementById('fileInput');
    const file = input.files && input.files[0];
    if(!file){ alert('Please select a file first.'); return; }

    const name = (file.name||'').toLowerCase();
    const ext = name.split('.').pop();

    // CSV -> parse and mock analyze
    if(ext === 'csv'){
        Papa.parse(file, { header:true, skipEmptyLines:true, complete: function(results){
            const rows = results.data || [];
            // If there's a 'review' column we'll use it, otherwise try to use the first text column
            const sampleCol = (rows[0] && rows[0].review) ? 'review' : (rows[0] ? Object.keys(rows[0])[0] : null);
            const extracted = rows.map(r => ({ review: sampleCol ? (r[sampleCol]||'') : JSON.stringify(r).slice(0,120) }));
            createMockBulkAnalysisFromReviews(extracted);
        }, error: function(err){ console.error(err); alert('CSV parsing failed.'); } });
        return;
    }

    // TXT -> read text lines as reviews
    if(ext === 'txt'){
        const reader = new FileReader();
        reader.onload = function(evt){ const content = evt.target.result || ''; const lines = content.split(/\r?\n/).filter(Boolean); const extracted = lines.map(l=>({review: l.slice(0,200)})); createMockBulkAnalysisFromReviews(extracted); }; reader.readAsText(file); return;
    }

    // For PDF/DOCX/XLSX etc — demo accepts but defers parsing to server. We'll create a single mock review to demonstrate the dashboard.
    if(['pdf','doc','docx','xls','xlsx'].includes(ext)){
        const mock = [{ review: `Uploaded file: ${file.name} (type: ${ext}). Server-side parsing recommended.` }];
        createMockBulkAnalysisFromReviews(mock);
        return;
    }

    // fallback
    alert('Unsupported file type for demo. Supported: csv, txt, pdf, doc, docx, xls, xlsx');
}

// creates a mock analysis object (keeps your existing mock structure) from an array of {review}
function createMockBulkAnalysisFromReviews(reviews){
    const mockBulkResults = (reviews || []).map((r, i) => {
        const sentiment = i % 3 === 0 ? 'Positive' : (i % 3 === 1 ? 'Negative' : 'Neutral');
        const aspects = (sentiment === 'Positive') ? { quality: 'Positive', delivery: 'Positive' } : { size: 'Negative', price: 'Neutral' };
        return { review: (r.review||'').slice(0,140), sentiment: sentiment, confidence: (0.7+Math.random()*0.3).toFixed(2), rating: (Math.floor(Math.random()*5)+1), date: `2024-05-${String(Math.floor(Math.random()*28)+1).padStart(2,'0')}`, aspects: aspects, emotion: ['Joy','Anger','Sadness','Neutral'][Math.floor(Math.random()*4)], intent: ['Purchase','Churn','Inquiry'][Math.floor(Math.random()*3)], is_sarcastic: Math.random() < 0.08, language: ['English','Hinglish','Spanish'][Math.floor(Math.random()*3)] };
    });

    const positiveCount = mockBulkResults.filter(r=>r.sentiment==='Positive').length;
    const negativeCount = mockBulkResults.filter(r=>r.sentiment==='Negative').length;
    const neutralCount = mockBulkResults.length - positiveCount - negativeCount;
    const total = mockBulkResults.length;
    const recommendationStatus = positiveCount > (negativeCount + neutralCount) ? 'Good' : (negativeCount > positiveCount ? 'Bad' : 'Decent');

    const analysis = {
        product_name: 'Uploaded File Analysis',
        product_image_url: '',
        summary: { Positive: positiveCount, Negative: negativeCount, Neutral: neutralCount, total: total },
        recommendation: { status: recommendationStatus, message: `Demo analysis of ${total} items. Overall sentiment: ${recommendationStatus}.` },
        drill_down_matrix: [ { aspect:'Quality', Positive:10, Negative:2, Neutral:1 }, { aspect:'Price', Positive:8, Negative:5, Neutral:3 }, { aspect:'Delivery', Positive:12, Negative:1, Neutral:0 }, { aspect:'Size', Positive:1, Negative:15, Neutral:4 } ],
        detailed_results: mockBulkResults
    };

    processBulkData(analysis);
}

// Charts & rendering
function updateChart(summary){ const data = [summary.Positive||0, summary.Negative||0, summary.Neutral||0]; const labels = ['Positive','Negative','Neutral']; const colors = ['#06d6a0','#ff6b6b','#9aa5b1']; if(sentimentChart) sentimentChart.destroy(); const ctx = document.getElementById('sentimentChart').getContext('2d'); sentimentChart = new Chart(ctx, { type:'doughnut', data:{ labels, datasets:[{ data, backgroundColor: colors, hoverOffset:4 }] }, options:{ responsive:true, plugins:{ legend:{ position:'top' } } } }); }
function updateAspectMatrixChart(matrixData){ const top = (matrixData||[]).slice(0,5); const labels = top.map(i=>i.aspect||'N/A'); const data = { labels, datasets: [ { label:'Positive', data: top.map(i=>i.Positive||0), backgroundColor:'#06d6a0' }, { label:'Negative', data: top.map(i=>i.Negative||0), backgroundColor:'#ff6b6b' }, { label:'Neutral', data: top.map(i=>i.Neutral||0), backgroundColor:'#9aa5b1' } ] }; if(aspectMatrixChart) aspectMatrixChart.destroy(); const ctx = document.getElementById('aspectMatrixChart').getContext('2d'); aspectMatrixChart = new Chart(ctx, { type:'bar', data, options:{ responsive:true, scales:{ x:{ stacked:true }, y:{ stacked:true, title:{ display:true, text:'Review Count' } } } } }); }
function updateTimeSeriesChart(detailedResults){ const daily = (detailedResults||[]).reduce((acc,it)=>{ const d = it.date || new Date().toISOString().slice(0,10); if(!acc[d]) acc[d] = { total:0, positive:0, negative:0 }; acc[d].total++; if(it.sentiment==='Positive') acc[d].positive++; if(it.sentiment==='Negative') acc[d].negative++; return acc; }, {}); const dates = Object.keys(daily).sort(); const pos = dates.map(d=> daily[d].total? (daily[d].positive/daily[d].total)*100:0); const neg = dates.map(d=> daily[d].total? (daily[d].negative/daily[d].total)*100:0); if(timeSeriesChart) timeSeriesChart.destroy(); const ctx = document.getElementById('timeSeriesChart').getContext('2d'); timeSeriesChart = new Chart(ctx, { type:'line', data:{ labels:dates, datasets:[ { label:'Positive Trend (%)', data:pos, borderColor:'#06d6a0', tension:0.1, fill:false }, { label:'Negative Trend (%)', data:neg, borderColor:'#ff6b6b', tension:0.1, fill:false } ] }, options:{ responsive:true, scales:{ y:{ min:0, max:100, title:{ display:true, text:'Percentage (%)' } } } } }); }

function displayRecommendation(productName, recommendation, imageUrl){ const card = document.getElementById('recommendationCard'); const content = document.getElementById('recommendationContent'); const message = document.getElementById('recommendationMessage'); const nameDisplay = document.getElementById('productNameDisplay'); const imageDisplay = document.getElementById('productImageDisplay'); if(!card) return; card.style.display = 'block'; nameDisplay.textContent = productName || 'Analyzed Product'; message.textContent = (recommendation && recommendation.message) ? recommendation.message : ''; if(imageUrl){ imageDisplay.src=imageUrl; imageDisplay.style.display='block'; } else { imageDisplay.style.display='none'; imageDisplay.src=''; } let icon='bi-info-circle-fill text-warning', title='MIXED REVIEWS', bg='border-warning'; if(recommendation && recommendation.status==='Good'){ icon='bi-check-circle-fill text-success'; title='GO FOR IT!'; bg='border-success'; } else if(recommendation && recommendation.status==='Bad'){ icon='bi-x-octagon-fill text-danger'; title='PROCEED WITH CAUTION'; bg='border-danger'; } content.innerHTML = `<i class="bi ${icon}" style="font-size:3rem;"></i><h2 class="card-text display-3 fw-bold">${title}</h2>`; card.className = `card shadow border-3 ${bg}`; }

function populateDetailedList(data){ const list = document.getElementById('detailedResultsList'); list.innerHTML=''; const kw = (document.getElementById('keywordSearch').value||'').toLowerCase(); (data||[]).forEach(item=>{ if(kw && !(item.review||'').toLowerCase().includes(kw)) return; const sentimentClass = getSentimentClass(item.sentiment); const aspectHtml = formatAspects(item.aspects); const ratingStars = getStarRating(item.rating); const emotionTag = item.emotion? `<span class="badge ${getSentimentClass(item.emotion)} text-uppercase me-1">${item.emotion}</span>`:''; const intentTag = item.intent? `<span class="badge ${item.intent==='Churn'?'badge-churn':'badge-inquiry'} text-uppercase me-1">${item.intent}</span>`:''; const sarcasmTag = item.is_sarcastic? `<span class="badge badge-sarcasm text-uppercase me-1">SARCASTIC</span>`:''; const languageTag = item.language && item.language!=='English'? `<span class="badge bg-light text-dark me-1">${item.language}</span>`:''; const li = ` <li class="list-group-item" data-sentiment="${item.sentiment}" data-rating="${item.rating||0}"> <div class="d-flex justify-content-between"> <span class="d-block mb-1 text-truncate"><strong>Review:</strong> ${item.review}</span> <span class="badge bg-light text-dark">${ratingStars}</span> </div> <div class="d-flex align-items-center mb-1"> <span class="badge ${sentimentClass} rounded-pill me-2">${item.sentiment} (${item.confidence})</span> ${emotionTag}${intentTag}${sarcasmTag}${languageTag} </div> <div class="mt-1">${aspectHtml}</div> </li>`; list.insertAdjacentHTML('beforeend', li); }); }
function filterReviews(sentimentFilter='All'){ let filtered = allReviewData; if(sentimentFilter!=='All') filtered = (allReviewData||[]).filter(i=>i.sentiment===sentimentFilter); populateDetailedList(filtered); }

function processBulkData(data){ currentAnalysisData = data||{}; document.getElementById('manual-analysis-section').style.display='none'; document.getElementById('bulk-analysis-output').style.display='block'; document.getElementById('resultsContainer').style.display='block'; allReviewData = data.detailed_results || []; const summary = data.summary || {Positive:0,Negative:0,Neutral:0,total: (allReviewData.length)}; document.getElementById('positiveCount').textContent = summary.Positive||0; document.getElementById('negativeCount').textContent = summary.Negative||0; document.getElementById('neutralCount').textContent = summary.Neutral||0; document.getElementById('totalReviews').textContent = summary.total||allReviewData.length; displayRecommendation(data.product_name||'Analyzed Product', data.recommendation||{}, data.product_image_url||''); updateChart(summary); updateAspectMatrixChart(data.drill_down_matrix||[]); updateTimeSeriesChart(allReviewData); populateDetailedList(allReviewData); }

// PDF generation: concise demo
async function generatePDFReport(){ if(!currentAnalysisData || Object.keys(currentAnalysisData).length===0){ alert('Please analyze a product first to generate a report.'); return; } const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text('Sentiment Analysis Report', 14, 20); doc.setFontSize(11); doc.text(currentAnalysisData.product_name || 'Uploaded File Analysis', 14, 30); doc.save((currentAnalysisData.product_name||'sentiment_report').replace(/\s+/g,'_') + '.pdf'); }

// initialization
window.addEventListener('DOMContentLoaded', ()=>{
    // default view
    document.getElementById('manual-analysis-section').style.display='block';
    document.getElementById('bulk-analysis-output').style.display='none';
    document.getElementById('resultsContainer').style.display='none';

    // sidebar link wiring (safe)
    document.querySelectorAll('.sidebar-link').forEach((link, idx) => {
        if (idx === 0) link.classList.remove('inactive');
        else link.classList.add('inactive');
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const target = (idx === 0) ? 'manual-analysis-section' : 'bulk-analysis-output';
            showSection(target, link);
        });
    });
});
</script>
</body>
</html>
